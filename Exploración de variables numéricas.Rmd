---
title: "Proyecto_Mineria"
author: "Alejandro Anton, Adrián González, Jose Ordoñez, Daniela Ramírez"
date: "2026-02-09"
output: html_document
---
```{r librerias}
library(haven)
library(dplyr)
library(purrr)
library(janitor)
library(stringr)
library(readr)
```


```{r leer y corregir datos}
archivos <- list.files("./datos/", pattern = "\\.sav$", full.names = TRUE)

nacimientos <- map_df(archivos, function(x) {
  
  df <- read_sav(x, user_na = TRUE) %>% 
    zap_labels() %>%
    clean_names()

  df[] <- lapply(df, as.character)
  
  df$anio <- str_extract(basename(x), "\\d{4}")
  
  return(df)
})

nacimientos <- nacimientos %>%
  mutate(across(
    everything(),
    ~ type.convert(.x, as.is = TRUE)
  ))

nacimientos$anio <- as.integer(nacimientos$anio)

divorcios <- nacimientos

divorcios <- divorcios %>%
  mutate(
    edadhom = na_if(edadhom, 999),
    edadmuj = na_if(edadmuj, 999)
  )

```

```{r variables numericas}
numericas <- sapply(divorcios, is.numeric)
names(divorcios)[numericas]

edades <- divorcios %>%
  select(edadhom, edadmuj)

```
```{r resumen numericas}
summary(edades)

sapply(edades, mean, na.rm = TRUE)
sapply(edades, sd, na.rm = TRUE)

lapply(names(edades), function(v) {
  hist(edades[[v]],
       main = paste("Distribución", v),
       xlab = "Edad",
       col = "lightblue")
})

set.seed(123)

lapply(edades, function(x) {
  shapiro.test(sample(x[!is.na(x)], 5000))
})

```
Se evaluó la normalidad de las variables edad del hombre y edad de la mujer mediante la prueba de Shapiro-Wilk.

Para la edad de los hombres se obtuvo un estadístico W = 0.9217 con p < 0.05, mientras que para la edad de las mujeres W = 0.9292 con p < 0.05. En ambos casos se rechaza la hipótesis nula de normalidad, concluyendo que las variables no siguen una distribución normal.

El análisis gráfico mediante histogramas y la comparación entre media y mediana evidencian que ambas variables presentan asimetría positiva (sesgo hacia la derecha), caracterizada por una mayor concentración de observaciones en edades medias y una cola extendida hacia edades más altas.


```{r}
names(divorcios)
```


```{r}
library(ggplot2)

nacimientos <- nacimientos %>%
  mutate(
    edad_madre = as.numeric(edadm),
    edad_padre = as.numeric(edadp),
    peso_libras = as.numeric(libras),
    hijos_vivos = as.numeric(tohivi)
  )

```


```{r}
ggplot(nacimientos, aes(x = edad_madre)) +
  geom_histogram(bins = 30) +
  labs(
    title = "Distribución de la edad de la madre",
    x = "Edad de la madre",
    y = "Frecuencia"
  )
```

```{r}
ggplot(nacimientos, aes(x = factor(hijos_vivos), y = edad_madre)) +
  geom_boxplot() +
  labs(
    title = "Edad de la madre según el número de hijos vivos",
    x = "Número de hijos vivos",
    y = "Edad de la madre"
  )
```

```{r}
ggplot(nacimientos, aes(x = edad_madre, y = peso_libras)) +
  geom_point(alpha = 0.3) +
  labs(
    title = "Relación entre la edad de la madre y el peso del recién nacido",
    x = "Edad de la madre",
    y = "Peso del recién nacido (libras)"
  )

```

## Variables categóricas
```{r Conversión factor}
# Nominales
divorcios$depreg  <- factor(divorcios$depreg)
divorcios$mupreg  <- factor(divorcios$mupreg)
```

```{r}
# Mes como ordinal
niveles_meses <- c(
  "Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
  "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"
)

divorcios$mesreg <- factor(
  divorcios$mesreg,
  levels = niveles_meses,
  ordered = TRUE
)
```

```{r Tablas de frecuencia}
tabla_frecuencia <- function(variable) {
  freq_abs <- table(variable, useNA = "ifany")
  freq_rel <- prop.table(freq_abs)

  data.frame(
    Categoria = names(freq_abs),
    Frecuencia = as.numeric(freq_abs),
    Proporcion = round(as.numeric(freq_rel), 4)
  )
}
```

# Departamento de registro
```{r}
divorcios %>%
  count(depreg, sort = TRUE)
```

# Municipio de registro (top 10)
```{r}
divorcios %>%
  count(mupreg, sort = TRUE) %>%
  head(10)
```


# Año de registro
```{r}
divorcios %>%
  count(anio)
```


# Grupo étnico del hombre
```{r}
divorcios %>%
  count(grethom, sort = TRUE)
```


# Grupo étnico de la mujer
```{r}
divorcios %>%
  count(gretmuj, sort = TRUE)
```


```{r}
# Convertir variables a numéricas
divorcios <- divorcios %>%
  mutate(
    edad_hombre = as.numeric(edadhom),
    edad_mujer  = as.numeric(edadmuj),
    esc_hombre  = as.numeric(eschom),
    esc_mujer   = as.numeric(escmuj)
  )

# Dataset para correlación
datos_cor <- divorcios %>%
  select(
    edad_hombre,
    edad_mujer,
    esc_hombre,
    esc_mujer
  ) %>%
  tidyr::drop_na()


# Matriz de correlación
matriz_cor <- cor(
  datos_cor,
  method = "pearson",
  use = "complete.obs"
)

# Tabla de correlación
knitr::kable(
  round(matriz_cor, 3),
  caption = "Matriz de correlación de divorcios en Guatemala"
)
```





